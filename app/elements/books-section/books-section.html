<dom-module id="books-section">
  <style>
    paper-fab {
      position: fixed;
      bottom: 24px;
      right: 44px;
    }
  </style>
  <template>
    <book-add on-added-book="_addBook"></book-add>
    
    <book-dialog book="{{selected}}"></book-dialog>

    <paper-material>
      <books-list 
        on-open-book-dialog="_openBookDialog" 
        books="{{books}}"
        selected="{{selected}}">
      </books-list>
    </paper-material>
    <paper-fab icon="add" id="add" on-tap="_openAddBookDialog"></paper-fab>
  </template>
  <script>
    Polymer({
      is: 'books-section',
      
      properties: {
        books: {
          notify: true
        },
        id: {
          type: Number
        }
      },
      
      observers: [
        '_booksChanged(books.*)'
      ],
      
      _booksChanged: function(books) {
        console.log(books);
        var ID = this._computeID(this.books);
        console.log('ID changed(' + ID + ')');
        this.id = ID;
      },
      
      _computeID: function(books) {
        var id=1;
        console.log('computing id:');
        console.log(books);
        for(var i=0; i<books.length; i++) {
          console.log(books[i].id);
          if(books[i].id>id) {
            id = books[i].id;
          }
        }
        id++;
        console.log('ID: ' + id);
    
        return id;
      },
      
      _openAddBookDialog: function() {
        var dialog = document.getElementById('addBookDialog');
        if(dialog) {
          dialog.open();
        }
      },
      
      _addBook: function(e) {
        for(var i=0; i<e.detail.amount; i++) {
          this.push('books', {
            id: this.id,
            author: e.detail.author,
            original: e.detail.original,
            title: e.detail.title,
            language: e.detail.language,
            tags: e.detail.tags,
            price: e.detail.price,
            dedication: e.detail.dedication
          });
        }
      },
      
      _openBookDialog: function() {
        
      }
    });
  </script>
</dom-module>