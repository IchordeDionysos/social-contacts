<dom-module id="contact-dialog">
	<template>
		<style>
			:host {
				display: block;
			}
			#pdpid {
				margin-top: 63px;
				overflow-y: auto;
				scroll-behavior: auto;
				width: 100%;
				max-height: 600px;
				padding: 0;
			}
		</style>
		<paper-dialog entry-animation="scale-up-animation"
					  exit-animation="fade-out-animation"
					  id="contactDetailDialog"
					  opened="{{opened}}">
			<paper-item style="padding-left: 11px;" class="header">
				<paper-icon-button 
							icon="icons:arrow-back" 
							on-tap="closeDialog">
				</paper-icon-button>
				<span>[[contact.fullname]]</span>
			</paper-item>
			<div id="pdpbd">
				<paper-input label="VollstÃ¤ndiger Name" value="{{contact.fullname}}"></paper-input>
				<div id="emailList">
				</div>
				<div id="phoneList">
				</div>
				<div id="addressList">
				</div>
			</div>
		</paper-dialog>
	</template>
	<script>
		Polymer({
			is: 'contact-dialog',

			properties: {
				contact: {
					type:Object,
					observer: '_setUp'
				},
				opened: {
					type: Boolean,
					notify: true,
					observer: '_updateContact'
				}
			},

			listeners: {
				'email': '_onEmail',
				'phone': '_onPhone',
				'address': '_onAddress'
			},

			closeDialog: function () {
				this.opened = false;
			},

			_updateContact: function(newVal, oldVal) {
				if(newVal === false && oldVal === true) {
					this.set('contact.emails', this.getEmails());
					this.set('contact.phones', this.getPhones());
					this.set('contact.addresses', this.getAddresses());
					console.log(this.contact);
					this.fire('contact', {
						contact: this.contact
					});
				}
			},

			_setUp: function(newVal, oldVal) {
				this.$.emailList.innerHTML = '';
				this.$.phoneList.innerHTML = '';
				this.$.addressList.innerHTML = '';

				if(this.contact.emails) {
					for (var i = 0; i < this.get('contact.emails').length; i++) {
						var email = document.createElement('contact-email');
						this.$.emailList.appendChild(email);
						email.label = this.get('contact.emails.' + i + '.label');
						email.email = this.get('contact.emails.' + i + '.value');
					}
				}
				this._onEmail();

				if(this.contact.phones) {
					for (var i = 0; i < this.get('contact.phones').length; i++) {
						var phone = document.createElement('contact-phone');
						this.$.phoneList.appendChild(phone);
						phone.label = this.get('contact.phones.' + i + '.label');
						phone.phone = this.get('contact.phones.' + i + '.value');
					}
				}
				this._onPhone();

				if(this.contact.addresses) {
					for (var i = 0; i < this.get('contact.addresses').length; i++) {
						var address = document.createElement('contact-address');
						this.$.addressList.appendChild(address);
						address.label = this.get('contact.addresses.' + i + '.label');
						address.address = this.get('contact.addresses.' + i + '.value');
					}
				}
				this._onAddress();
			},

			_onEmail: function() {
				var emails = Array.prototype.slice.call(this.querySelectorAll('contact-email'));
				for (var i = 0; i < emails.length-1; i++) {
					if(emails[i].email === '') {
						emails[i].remove();
						emails.splice(i, 1);
					}
				}
				if (emails.length === 0 || emails[emails.length-1].email !== '') {
					var email = document.createElement('contact-email');
					this.$.emailList.appendChild(email);
				}
				this.$.contactDetailDialog.notifyResize();
			},

			_onPhone: function() {
				var phones = Array.prototype.slice.call(this.querySelectorAll('contact-phone'));
				for (var i = 0; i < phones.length-1; i++) {
					if(phones[i].phone === '') {
						phones[i].remove();
						phones.splice(i, 1);
					}
				}
				if (phones.length === 0 || phones[phones.length-1].phone !== '') {
					var phone = document.createElement('contact-phone');
					this.$.phoneList.appendChild(phone);
				}
				this.$.contactDetailDialog.notifyResize();
			},

			_onAddress: function() {
				var addresses = Array.prototype.slice.call(this.querySelectorAll('contact-address'));
				for (var i = 0; i < addresses.length-1; i++) {
					if(addresses[i].address === '') {
						addresses[i].remove();
						addresses.splice(i, 1);
					}
				}
				if (addresses.length === 0 || addresses[addresses.length-1].address !== '') {
					var address = document.createElement('contact-address');
					this.$.addressList.appendChild(address);
				}
				this.$.contactDetailDialog.notifyResize();
			},

			getEmails: function() {
				var emailElements = this.querySelectorAll('contact-email');
				var emails = [];
				for (var i = 0; i < emailElements.length; i++) {
					if (emailElements[i].email !== "") {
						emails.push({
							label: emailElements[i].label,
							value: emailElements[i].email
						});
					}
				}
				return emails;
			},

			getPhones: function() {
				var phoneElements = this.querySelectorAll('contact-phone');
				var phones = [];
				for (var i = 0; i < phoneElements.length; i++) {
					if (phoneElements[i].phone !== "") {
						phones.push({
							label: phoneElements[i].label,
							value: phoneElements[i].phone
						});
					}
				}
				return phones;
			},

			getAddresses: function() {
				var addressElements = this.querySelectorAll('contact-address');
				var addresses = [];
				for (var i = 0; i < addressElements.length; i++) {
					if (addressElements[i].address !== "") {
						addresses.push({
							label: addressElements[i].label,
							value: addressElements[i].address
						});
					}
				}
				return addresses;
			}
		});
	</script>
</dom-module>