<dom-module id="contact-add">
	<style>
		paper-dialog {
			padding: 0 16px;
			padding-bottom: 16px;
		}
		iron-icon {
			color: var(--secondary-text-color);
		}
		paper-input {
			display: inline-block;
			width: calc(100% - 28px);
		}
		#pdpid {
			margin-top: 63px;
			overflow-y: auto;
			scroll-behavior: auto;
			width: 100%;
			max-height: 600px;
			padding: 0;
		}
	</style>
	<template>
		<paper-dialog 
			entry-animation="scale-up-animation"
			exit-animation="fade-out-animation"
			opened="{{opened}}"
			id="addContactDialog">
			<div id="pdpbd">
				<paper-icon-button 
					icon="clear" 
					on-tap="_clearDialog" 
					dialog-dismiss 
					style="float: left; left: -28px;">
				</paper-icon-button>
				<paper-button 
					dialog-confirm 
					on-tap="_addContact" 
					style="float: right;"
					raised>Add
				</paper-button>
			</div>
			<div id="pdpid">
				<iron-icon icon="social:person"></iron-icon>
				<paper-input value="{{fullname}}" label="VollstÃ¤ndiger Name"></paper-input>
				<div id="addEmails">
					<contact-email></contact-email>
				</div>
				<div id="addPhones">
					<contact-phone></contact-phone>
				</div>
				<div id="addAddresses">
					<contact-address></contact-address>
				</div>
			</div>
		</paper-dialog>
	</template>
	<script>
		Polymer({
			is: 'contact-add',
			
			properties: {
				opened: {
					type: Boolean,
					notify: true
				}
			},

			listeners: {
				'email': '_onEmail',
				'phone': '_onPhone',
				'address': '_onAddress'
			},

			_onEmail: function() {
				var emails = Array.prototype.slice.call(this.querySelectorAll('contact-email'));
				for (var i = 0; i < emails.length-1; i++) {
					if(emails[i].email === '') {
						emails[i].remove();
						emails.splice(i, 1);
					}
				}
				if (emails[emails.length-1].email !== '') {
					var email = document.createElement('contact-email');
					this.$.addEmails.appendChild(email);
				}
				this.$.addContactDialog.notifyResize();
			},

			_onPhone: function() {
				var phones = Array.prototype.slice.call(this.querySelectorAll('contact-phone'));
				for (var i = 0; i < phones.length-1; i++) {
					if(phones[i].phone === '') {
						phones[i].remove();
						phones.splice(i, 1);
					}
				}
				if (phones[phones.length-1].phone !== '') {
					var phone = document.createElement('contact-phone');
					this.$.addPhones.appendChild(phone);
				}
				this.$.addContactDialog.notifyResize();
			},

			_onAddress: function() {
				var addresses = Array.prototype.slice.call(this.querySelectorAll('contact-address'));
				for (var i = 0; i < addresses.length-1; i++) {
					if(addresses[i].address === '') {
						addresses[i].remove();
						addresses.splice(i, 1);
					}
				}
				if (addresses[addresses.length-1].address !== '') {
					var address = document.createElement('contact-address');
					this.$.addAddresses.appendChild(address);
				}
				this.$.addContactDialog.notifyResize();
			},
			
			_clearDialog: function() {
				this.fullname = '';

				var email = document.createElement('contact-email');
				var phone = document.createElement('contact-phone');
				var address = document.createElement('contact-address');

				var emailWrapper = document.querySelector('#addEmails');
				var phoneWrapper = document.querySelector('#addPhones');
				var addressWrapper = document.querySelector('#addAddresses');

				emailWrapper.innerHTML = '';
				phoneWrapper.innerHTML = '';
				addressWrapper.innerHTML = '';

				emailWrapper.appendChild(email);
				phoneWrapper.appendChild(phone);
				addressWrapper.appendChild(address);
			},
			
			_addContact: function() {
				this.fire('added-contact', {
					fullname: this.fullname,
					emails: this.getEmails(),
					phones: this.getPhones(),
					addresses: this.getAddresses()
				});
				this._clearDialog();
			},

			getEmails: function() {
				var emailElements = this.querySelectorAll('contact-email');
				var emails = [];
				for (var i = 0; i < emailElements.length; i++) {
					if (emailElements[i].email !== "") {
						emails.push({
							label: emailElements[i].label,
							email: emailElements[i].email
						});
					}
				}
				return emails;
			},

			getPhones: function() {
				var phoneElements = this.querySelectorAll('contact-phone');
				var phones = [];
				for (var i = 0; i < phoneElements.length; i++) {
					if (phoneElements[i].phone !== "") {
						phones.push({
							label: phoneElements[i].label,
							phone: phoneElements[i].phone
						});
					}
				}
				return phones;
			},

			getAddresses: function() {
				var addressElements = this.querySelectorAll('contact-address');
				var addresses = [];
				for (var i = 0; i < addressElements.length; i++) {
					if (addressElements[i].address !== "") {
						addresses.push({
							label: addressElements[i].label,
							address: addressElements[i].address
						});
					}
				}
				return addresses;
			}
		});
	</script>
</dom-module>